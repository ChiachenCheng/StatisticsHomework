# Week1 One-way ANOVA
## èƒŒæ™¯æè¿°
ä¸ºäº†è°ƒæŸ¥åƒå·§å…‹åŠ›å¯¹å¿ƒè¡€ç®¡å¥åº·çš„å½±å“ï¼Œå®éªŒç”±ä¸‰ç§ç±»å‹çš„å·§å…‹åŠ›ç»„æˆï¼š100gçš„é»‘å·§å…‹åŠ›ï¼Œå«æœ‰200mgå…¨è„‚ç‰›å¥¶çš„100gé»‘å·§å…‹åŠ›å’Œ200gçš„ç‰›å¥¶å·§å…‹åŠ›ã€‚12ä¸ªå®éªŒå¯¹è±¡ï¼š7å¥³5ç”·ã€‚åœ¨ä¸åŒçš„å¤©æ•°é‡Œï¼Œæ¯ä¸ªå®éªŒå¯¹è±¡å°†åƒä¸€ç§ç±»å‹çš„å·§å…‹åŠ›ï¼Œä¸€ä¸ªå°æ—¶åæµ‹é‡ä»–ä»¬è¡€æµ†çš„æ€»æŠ—æ°§èƒ½åŠ›ã€‚ 
è¿™æ˜¯ä¸€ä¸ªå› å­æ°´å¹³æ•° ğ‘ = 3 å’Œé‡å¤æ¬¡æ•° ğ‘› = 12 çš„å•å› å­å®éªŒã€‚


## æ•°æ®æè¿°
å®éªŒæ¬¡åºæœ¬èº«å…·æœ‰éšæœºæ€§ï¼Œæ— éœ€å†éšæœºåŒ–

| å˜é‡å | å˜é‡å«ä¹‰ | å˜é‡ç±»å‹ | å˜é‡å–å€¼èŒƒå›´ |
| :----------: | :--------: | :----------: | :----------: |
| ï¼ˆè‡ªå˜é‡ï¼‰Chocolate | å·§å…‹åŠ›ç±»å‹ | categorical variable | [1, 2, 3] |
| ï¼ˆå› å˜é‡ï¼‰Capacity | è¡€æµ†æµ“åº¦ | continuous variable | Real |



```python
import pandas as pd
print('Randomized test sequence: \n', pd.read_csv('project1.csv').values)
```

    Randomized test sequence: 
     [[  1.    1.  118.8]
     [  2.    1.  122.6]
     [  3.    1.  115.6]
     [  4.    1.  113.6]
     [  5.    1.  119.5]
     [  6.    1.  115.9]
     [  7.    1.  115.8]
     [  8.    1.  115.1]
     [  9.    1.  116.9]
     [ 10.    1.  115.4]
     [ 11.    1.  115.6]
     [ 12.    1.  107.9]
     [  1.    2.  105.4]
     [  2.    2.  101.1]
     [  3.    2.  102.7]
     [  4.    2.   97.1]
     [  5.    2.  101.9]
     [  6.    2.   98.9]
     [  7.    2.  100. ]
     [  8.    2.   99.8]
     [  9.    2.  102.6]
     [ 10.    2.  100.9]
     [ 11.    2.  104.5]
     [ 12.    2.   93.5]
     [  1.    3.  102.1]
     [  2.    3.  105.8]
     [  3.    3.   99.6]
     [  4.    3.  102.7]
     [  5.    3.   98.8]
     [  6.    3.  100.9]
     [  7.    3.  102.8]
     [  8.    3.   98.7]
     [  9.    3.   94.7]
     [ 10.    3.   97.8]
     [ 11.    3.   99.7]
     [ 12.    3.   98.6]]


## é—®é¢˜ 
æ³¨ï¼šè¿™é‡Œä½¿ç”¨ $\alpha=0.05$ çš„æ˜¾è‘—æ€§æ°´å¹³

1. è¯•åˆ¤æ–­é£Ÿç”¨çš„ 3 ç§å·§å…‹åŠ›å¯¹å¿ƒè¡€ç®¡å¥åº·çš„å½±å“æ˜¯å¦æœ‰å·®å¼‚.
2. è¯•åˆ¤æ–­è¯¥å®éªŒç”¨One-way ANOVAæ¨¡å‹æ˜¯å¦æ°å½“.
3. ä¼°è®¡é£Ÿç”¨è¿™ 3 ç§å·§å…‹åŠ› 1h åè¡€æµ†çš„æ€»æŠ—æ°§èƒ½åŠ›å‡å€¼å’Œè¯¯å·®çš„æ–¹å·®.
4. è‹¥Q1åˆ¤æ–­å­˜åœ¨å·®å¼‚ï¼Œè¯·è¿›è¡Œå¤šé‡æ¯”è¾ƒ.

## è§£å†³æ–¹æ¡ˆ
**Q1:**  
æ£€éªŒå‡è®¾ $H_0: \mu_1 = \mu_2 = \mu_3 = \mu_4$ ; vs $H_1: \mu_1, \mu_2, \mu_3, \mu_4$ä¸å…¨ç›¸ç­‰ï¼›

åœ¨æœ¬é—®é¢˜ä¸­ï¼Œé‡‡ç”¨å•å› å­æ–¹å·®åˆ†ææ¨¡å‹ï¼ˆOne-way ANOVAæ¨¡å‹ï¼‰å¯¹é—®é¢˜è¿›è¡Œåˆ†æã€‚è®¡ç®—å¾—å‡ºæ–¹å·®åˆ†æè¡¨ï¼Œç„¶åè®¡ç®—å‡ºæ£€éªŒç»Ÿè®¡é‡Fã€‚è‹¥$F\ge F_{1-\alpha}(f_A,f_e)$ï¼Œè¯´æ˜$H_0$æˆç«‹ï¼Œå› å­ä¸æ˜¾è‘—ï¼›å¦åˆ™è¯´æ˜$H_0$ä¸æˆç«‹ï¼Œè¯´æ˜å› å­æ˜¾è‘—ã€‚å…¶ä¸­$f_A,f_e$åˆ†åˆ«ä¸ºå› å­å’Œè¯¯å·®çš„è‡ªç”±åº¦ã€‚

åˆ©ç”¨pythonè¿›è¡Œåˆ†æå¾—åˆ°çš„å…·ä½“åˆ†æç»“æœå¦‚ä¸‹ï¼š


```python
# Import standard packages
import numpy as np
import pandas as pd
import scipy.stats as stats
import matplotlib.pyplot as plt
import math

# Import additional packages
from statsmodels.formula.api import ols
from statsmodels.stats.anova import anova_lm
from scipy.stats import f

alpha = 0.05
a = 3
n = 12 # ä¸è¯¾ä¸Šè®²çš„ç¬¦å·æœ‰å·®å¼‚ï¼Œè¯¾ä¸Šä½¿ç”¨m
x = pd.read_csv('project1.csv')
data = x.values[:,1:3] # dataä¸ºå»é™¤åºå·ä¹‹åçš„æ•°æ®

# Sort them into groups, according to column 1("Chocolate")
group1 = data[data[:,0] == 1,1]
group2 = data[data[:,0] == 2,1]
group3 = data[data[:,0] == 3,1]
# print(group1)

# Do the one-way ANOVA
df = pd.DataFrame(data, columns = ['Chocolate', 'Capacity'])   
model = ols('Capacity ~ C(Chocolate)', df).fit()
anovaResults = round(anova_lm(model), 2) # è®¡ç®—æ–¹å·®åˆ†æè¡¨ï¼Œä¿ç•™ä¸¤ä½å°æ•°
print('The ANOVA table: \n', anovaResults)  

F0, pVal1 = stats.f_oneway(group1, group2, group3)
# æ³•1ï¼š
# pVal1ä¸ºï½å€¼
if pVal1 < alpha:
    print('\nSince p-value < 0.05, reject H0.')
else:
    print('\nAccept H0.') 
    
# æ³•2ï¼š
# ï¼ˆä½¿ç”¨ä¹¦ä¸Šç¬¦å·ï¼‰dfn=f_A=r-1, dfd=n-r=f_e=r(m-1)
F = round(f.ppf(0.95,dfn = a-1,dfd = a*n-a), 2)
if F0 > F:
    print('Since F0 > F(0.05,2,33) = ', F, ', reject H0.')
else:
    print('Accept H0.') 
```

    The ANOVA table: 
                     df   sum_sq  mean_sq      F  PR(>F)
    C(Chocolate)   2.0  1952.64   976.32  93.58     0.0
    Residual      33.0   344.31    10.43    NaN     NaN
    
    Since p-value < 0.05, reject H0.
    Since F0 > F(0.05,2,33) =  3.28 , reject H0.


ç”±æ–¹å·®åˆ†æè¡¨å¯çŸ¥ï¼ŒPå€¼å°äº 0.05 ä¸”Få€¼å¤§äº 3.28ï¼Œè½å…¥æ‹’ç»åŸŸ$W=\{F\ge F_{1-\alpha}(f_A,f_e)\}$ä¸­ï¼Œæ•…æ‹’ç»åŸå‡è®¾$H_0$ï¼Œè¯´æ˜å› å­æ˜¾è‘—ã€‚å³é£Ÿç”¨çš„ 3 ç§å·§å…‹åŠ›å¯¹å¿ƒè¡€ç®¡å¥åº·çš„å½±å“æœ‰å·®å¼‚.ã€‚

**Q2:**  
ANOVAæ¨¡å‹ï¼š 
$y_{ij} = \mu + \tau_i + \epsilon_{ij}$ çš„è¯¯å·®æœä»æ­£æ€ç‹¬ç«‹åˆ†å¸ƒï¼Œå…¶å‡å€¼ä¸ºé›¶ï¼Œæ–¹å·®ä¸ºæœªçŸ¥çš„å¸¸æ•°$\sigma^2$ã€‚ 
æƒ³è¦åˆ¤æ–­ANOVAæ¨¡å‹æ˜¯å¦æ°å½“ï¼Œå¯ä»¥åˆ©ç”¨æ®‹å·®æ£€æµ‹æ¥è¿›è¡Œåˆ†æã€‚  
å¤„ç† $i$ çš„è§‚æµ‹å€¼ $j$ çš„æ®‹å·®å®šä¹‰ä¸ºï¼š$e_{ij} = y_{ij} - \hat{y}_{ij}$  
å…¶ä¸­$\hat{y}_{ij}$æ˜¯å¯¹åº”äº$y_{ij}$çš„ä¸€ä¸ªä¼°è®¡ï¼Œ 
$\hat{y}_{ij} = \hat{\mu} + \hat{\tau}_i = \overline{y}_{Â·Â·} + (\overline{y}_{iÂ·} - \overline{y}_{Â·Â·}) = \overline{y}_{iÂ·}$  

**1. ç‹¬ç«‹æ€§æ£€éªŒ**  
ç”±äºé¢˜ç›®ä¸­çš„æ•°æ®ä¸æ˜¯æŒ‰ç…§ä¸€å®šæ—¶é—´é¡ºåºæ”¶é›†çš„ï¼Œæ— æ³•ç”»å‡ºæ®‹å·®çš„æ—¶åºå›¾ï¼Œæ•…æ— æ³•åˆ©ç”¨æ®‹å·®å›¾æ£€æµ‹æ®‹å·®ä¹‹é—´çš„ç›¸å…³æ€§ã€‚

åˆ©ç”¨Durbin-Watsonæ£€éªŒï¼Œåˆç§°DWæ£€éªŒæ¥åšç‹¬ç«‹æ€§æ£€éªŒã€‚æ˜¯ç”¨æ¥æ£€éªŒåˆ†æä¸­æ®‹å·®çš„ä¸€é˜¶è‡ªç›¸å…³æ€§çš„ã€‚  
å„æ®‹å·®çš„ç›¸å…³æ€§æ–¹ç¨‹ä¸ºï¼š$e_i = \rho * e_{i-1} + v_i$ï¼Œæ£€éªŒçš„åŸå‡è®¾ä¸ºï¼š$\rho = 0$ï¼Œå¤‡æ‹©å‡è®¾ä¸ºï¼š$\rho \neq 0$  
æ£€éªŒç»Ÿè®¡é‡ä¸ºï¼š$d = \frac{\sum^T_{t=2}\quad(e_i-e_{i-1})^2}{\sum^T_{t=1}\quad e_i^2}$  
è¯¥ç»Ÿè®¡é‡å€¼è¶Šæ¥è¿‘ 2 è¶Šå¥½ï¼Œä¸€èˆ¬åœ¨ 1~3 ä¹‹é—´è¯´æ˜æ²¡é—®é¢˜ï¼Œå°äº 1 è¿™è¯´æ˜æ®‹å·®å­˜åœ¨è‡ªç›¸å…³æ€§ï¼ˆæœ‰ä¸´ç•Œå€¼è¡¨å¯ä»¥æŸ¥ï¼‰ã€‚  
æ–‡çŒ®å‚è€ƒï¼šhttps://en.wikipedia.org/wiki/Durbin%E2%80%93Watson_statistic


```python
# è®¡ç®—æŠ—æ°§èƒ½åŠ›çš„æ®‹å·®
data_res = data.astype(float) * 1
list_power = [1, 2, 3]
for k in list_power:
    cnt = data_res[data_res[:,0] == k,1]
    data_res[data_res[:,0] == k,1] = cnt - np.mean(cnt)

# ç”¨Durbin-Watsonæ£€éªŒè¿›è¡Œç‹¬ç«‹æ€§æ£€éªŒ
def durbin_watson(residuals):
    nume = sum(np.diff(residuals.T) ** 2)
    deno = sum(residuals ** 2)
    return nume / deno
res = data_res[:, 1]
dw = durbin_watson(res)
print('Durbin-Watsonæ£€éªŒçš„ç»Ÿè®¡é‡ä¸ºï¼š', round(dw,2))
```

    Durbin-Watsonæ£€éªŒçš„ç»Ÿè®¡é‡ä¸ºï¼š 2.3


ç”±åˆ†æå¯çŸ¥ï¼ŒDurbin-Watsonæ£€éªŒçš„ç»Ÿè®¡é‡ä¸ºï¼š2.3ï¼Œåœ¨ 1~3 ä¹‹é—´ä¸”éå¸¸æ¥è¿‘2 ï¼Œæ•…æ²¡æœ‰è¿åç‹¬ç«‹æ€§çš„å‡å®šã€‚  

**2. æ–¹å·®é½æ€§æ£€éªŒ** 

åœ¨è¿›è¡Œæ–¹å·®åˆ†ææ—¶è¦æ±‚rä¸ªæ–¹å·®ç›¸ç­‰ï¼Œè¿™ç§°ä¸ºæ–¹å·®é½æ€§ã€‚æ–¹å·®é½æ€§æ£€éªŒçš„åŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾åˆ†åˆ«å¦‚ä¸‹ï¼š
$H_0:\sigma_1^2=\sigma_2^2=...=\sigma_r^2\  vs\  H_1:è¯¸\sigma_i^2ä¸å…¨ç›¸ç­‰$.

ã€æ³•1ã€‘Bartlettæ£€éªŒçš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æ±‚å–ä¸åŒç»„ä¹‹é—´çš„å¡æ–¹ç»Ÿè®¡é‡ï¼Œç„¶åæ ¹æ®å¡æ–¹ç»Ÿè®¡é‡çš„å€¼æ¥åˆ¤æ–­ç»„é—´æ–¹å·®æ˜¯å¦ç›¸ç­‰ã€‚è¯¥æ–¹æ³•æåº¦ä¾èµ–äºæ•°æ®æ˜¯æ­£æ€åˆ†å¸ƒï¼Œå¦‚æœæ•°æ®éæ­£æ€åˆ†å¸ƒï¼Œåˆ™çš„å‡ºæ¥çš„ç»“æœåå·®å¾ˆå¤§ã€‚  
Bartlettæ£€éªŒç»Ÿè®¡é‡ä¸ºï¼š$\chi_0^2 = 2.3026\frac{q}{c}$  
å…¶ä¸­ï¼Œ$q = (N - a)log_{10}S_p^2 - \sum_{i=1}^a(n_i - 1)log_{10}S_i^2$  
$c = 1 + \frac{1}{3(a-1)}(\sum_{i=1}^a(n_i-1)^{-1} - (N - a)^{-1})$  
$S_p^2 = \frac{\sum_{i=1}^a\quad(n_i-1)S_i^2}{N - a}$ ä¸”$S_i^2$æ˜¯ç¬¬ $i$ ä¸ªæ€»ä½“çš„æ ·æœ¬æ–¹å·®ï¼›å½“$\chi_0^2 > \chi_{\alpha,a-1}^2$ æ—¶ï¼Œæ‹’ç»$H_0$ï¼Œå…¶ä¸­$\chi_{\alpha,a-1}^2$æ˜¯è‡ªç”±åº¦ä¸º$a-1$çš„å¡æ–¹åˆ†å¸ƒä¸Šçš„ $\alpha$ åˆ†ä½æ•°ã€‚


```python
# ç”¨Bartlettæ£€éªŒè¿›è¡Œæ–¹å·®é½æ€§æ£€éªŒ
bart, pVal2 = stats.bartlett(group1, group2, group3)
bart_stat = stats.chi2.isf(alpha, a-1)

# æ³•1ï¼š
print('Bartlettæ£€éªŒçš„På€¼ä¸ºï¼š', round(pVal2, 2))
if pVal2 < alpha:
    print('Since p-value < 0.05, reject H0.')
else:
    print('Accept H0')  

# æ³•2ï¼š
print('Bartlettæ£€éªŒç»Ÿè®¡é‡ï¼š', round(bart, 2))
print('ğœ’_(ğ›¼,ğ‘âˆ’1)^2: ', round(bart_stat, 2))
if bart > bart_stat:
    print('Since ğœ’_0^2 > ğœ’_(ğ›¼,ğ‘âˆ’1)^2, reject H0.')
else:
    print('Accept H0') 
```

    Bartlettæ£€éªŒçš„På€¼ä¸ºï¼š 0.81
    Accept H0
    Bartlettæ£€éªŒç»Ÿè®¡é‡ï¼š 0.42
    ğœ’_(ğ›¼,ğ‘âˆ’1)^2:  5.99
    Accept H0


ç”±åˆ†æå¯çŸ¥ï¼ŒBartlettæ£€éªŒçš„På€¼å¤§äº 0.05 ä¸”Bartlettæ£€éªŒç»Ÿè®¡é‡å°äº 7.81ï¼Œæ•…æ¥å—åŸå‡è®¾ï¼Œå³æ®‹å·®å…·æœ‰æ–¹å·®é½æ€§ã€‚  

ã€æ³•2ã€‘Leveneæ£€éªŒæ˜¯å°†æ¯ä¸ªå€¼å…ˆè½¬æ¢ä¸ºè¯¥å€¼ä¸å…¶ç»„å†…å‡å€¼çš„åç¦»ç¨‹åº¦ï¼Œç„¶åå†ç”¨è½¬æ¢åçš„åç¦»ç¨‹åº¦å»åšæ–¹å·®åˆ†æï¼Œå³ç»„é—´æ–¹å·®/ç»„å†…æ–¹å·®ã€‚ä¿®æ­£åçš„Leveneæ£€éªŒä¸­çš„å‡å€¼é‡‡ç”¨ä¸­ä½æ•°çš„è®¡ç®—æ–¹æ³•ï¼Œå› æ­¤è¿™é‡Œçš„åå·®ç”¨æ¯ä¸ªå¤„ç†çš„è§‚æµ‹å€¼$y_{ij}$ä¸è¯¥å¤„ç†ä¸­çš„ä¸­ä½æ•°$\tilde{y}_{iÂ·}$çš„åå·®çš„ç»å¯¹å€¼æ¥è¡¨ç¤ºï¼š$d_{ij} = |y_{ij} - \tilde{y}_{iÂ·}|, i = 1,2,Â·Â·Â·,a;j = 1,2,Â·Â·Â·,n$


```python
# ç”¨Leveneæ£€éªŒè¿›è¡Œæ–¹å·®é½æ€§æ£€éªŒ
lene, pVal3 = stats.levene(group1, group2, group3)
print('Leveneæ£€éªŒçš„På€¼ä¸ºï¼š', round(pVal3, 2))
if pVal3 < alpha:
    print('Since p-value < 0.05, reject H0.')
else:
    print('Accept H0')  
   
```

    Leveneæ£€éªŒçš„På€¼ä¸ºï¼š 0.98
    Accept H0


ç”±åˆ†æå¯çŸ¥ï¼ŒLeveneæ£€éªŒçš„På€¼å¤§äº 0.05ï¼Œæ•…æ®‹å·®å…·æœ‰æ–¹å·®é½æ€§ã€‚

**3. æ­£æ€æ€§æ£€éªŒ**  

æ­£æ€æ€§æ£€éªŒç”¨äºåˆ¤æ–­æ€»ä½“åˆ†å¸ƒæ˜¯å¦ä¸ºæ­£æ€åˆ†å¸ƒã€‚å…¶æ£€éªŒå‡è®¾$H_0:æ€»ä½“åˆ†å¸ƒç¬¦åˆæ­£æ€åˆ†å¸ƒ\  vs\  H_1:æ€»ä½“åˆ†å¸ƒä¸ç¬¦åˆæ­£æ€åˆ†å¸ƒ$.
ã€æ³•1ã€‘åˆ©ç”¨qqå›¾ï¼ˆThe quantitle-quantile plotï¼‰ï¼Œæ¥æ£€éªŒæ•°æ®åˆ†å¸ƒçš„ç›¸ä¼¼æ€§ã€‚ä»¤Xè½´ä¸ºæ­£æ€åˆ†å¸ƒçš„åˆ†ä½æ•°ï¼ŒYè½´ä¸ºæ ·æœ¬åˆ†ä½æ•°ï¼Œå¦‚æœè¿™ä¸¤è€…æ„æˆçš„ç‚¹åˆ†å¸ƒåœ¨ä¸€æ¡ç›´çº¿ä¸Šï¼Œå°±è¯æ˜æ ·æœ¬æ•°æ®ä¸æ­£æ€åˆ†å¸ƒå­˜åœ¨çº¿æ€§ç›¸å…³æ€§ï¼Œå³æœä»æ­£æ€åˆ†å¸ƒã€‚


```python
# ç”¨qqå›¾è¿›è¡Œæ­£æ€æ€§æ£€éªŒ
osm, osr = stats.probplot(res, dist = 'norm', plot = plt)
x1 = osm[0][0]
y1 = osm[1][0]
plt.text(x1, y1, '%.2f' % float(y1), ha = 'center', va = 'bottom',fontsize = 9)
x2 = osm[0][-1]
y2 = osm[1][-1]
plt.text(x2, y2, '%.2f' % float(y2), ha = 'center', va = 'bottom',fontsize = 9)
plt.grid()
plt.show()

print(osm[1])
```


â€‹    
![png](output_16_0.png)
â€‹    


    [-8.15833333 -7.2        -5.48333333 -3.6        -2.45833333 -2.38333333
     -1.8        -1.58333333 -1.48333333 -1.38333333 -0.95833333 -0.9
     -0.7        -0.65833333 -0.58333333 -0.48333333 -0.45833333 -0.45833333
     -0.25833333 -0.15833333  0.2         0.4         0.71666667  0.84166667
      1.2         1.9         1.91666667  2.          2.51666667  2.61666667
      2.74166667  3.44166667  3.8         4.7         5.61666667  6.54166667]


ç”±ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæ€»ä½“ä¸Šæ¥çœ‹ï¼Œè¯¯å·®åˆ†å¸ƒæ˜¯è¿‘ä¼¼æ­£æ€çš„ï¼›qqå›¾åœ¨å³è¾¹åŸºæœ¬ç¬¦åˆä¸€æ¡ç›´çº¿ï¼Œåœ¨å·¦è¾¹å…ˆç¨æœ‰ä¸Šç¿˜ï¼Œç¨å‘ä¸‹å¼¯æ›²ã€‚è¿™æ„å‘³ç€è¯¯å·®åˆ†å¸ƒçš„å·¦ä¾§çš„å°¾éƒ¨æ¯”èµ·æ­£æ€åˆ†å¸ƒçš„å°¾éƒ¨è¦æ›´åšä¸€äº›ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€å¤§çš„æ®‹å·®å‡ºç°åœ¨å°äºçš„ä¸€ä¾§ï¼Œä¸”å¤§äºæœŸæœ›çš„å€¼ã€‚
æ£€æµ‹å¼‚å¸¸å€¼çš„æ–¹æ³•ï¼š  
è®¡ç®—æ ‡å‡†åŒ–æ®‹å·®ï¼š$d_{ij} = \frac{e_{ij}}{\sqrt{MS_E}}$ã€‚ä¸€èˆ¬åœ°ï¼Œæ ‡å‡†åŒ–æ®‹å·®çº¦ 68% è½åœ¨ Â±1 ä¹‹å†…ï¼Œçº¦ 95% è½åœ¨ Â±2 ä¹‹å†…ï¼Œå‡ ä¹å…¨éƒ¨è½åœ¨ Â±3 ä¹‹å†…ã€‚æ ‡å‡†åŒ–æ®‹å·®çš„ç»å¯¹å€¼å¤§äº3çš„æ®‹å·®æ˜¯ä¸€ä¸ªå¯èƒ½çš„å¼‚å¸¸å€¼ã€‚  
ç”±ä¸Šè¿°å…¬å¼å¾— $d_1 = \frac{e_1}{\sqrt{MS_E}} = \frac{8.158}{\sqrt{10.43}} = 2.526 < 3$ï¼Œè¯´æ˜æ— æ˜æ˜¾çš„å¼‚å¸¸å€¼ï¼Œå³æ®‹å·®æ˜¯æœä»æ­£æ€åˆ†å¸ƒçš„ã€‚

ã€æ³•2ã€‘åˆ©ç”¨Shapiro-Wilkæ£€éªŒæ¥åšæ­£æ€æ€§æ£€éªŒï¼Œå…¶åŸå‡è®¾ï¼šæ ·æœ¬æ•°æ®ç¬¦åˆæ­£æ€åˆ†å¸ƒã€‚ï¼ˆæ³¨ï¼šé€‚ç”¨äºå°æ ·æœ¬ï¼‰  
åˆ©ç”¨æ–¹æ³•stats.shapiro()æ£€éªŒæ­£æ€æ€§ï¼Œè¾“å‡ºç»“æœä¸­ç¬¬ä¸€ä¸ªä¸ºç»Ÿè®¡é‡ï¼Œç¬¬äºŒä¸ªä¸ºPå€¼ï¼ˆç»Ÿè®¡é‡è¶Šæ¥è¿‘ 1 è¶Šè¡¨æ˜æ•°æ®å’Œæ­£æ€åˆ†å¸ƒæ‹Ÿåˆçš„å¥½ï¼ŒPå€¼å¤§äºæŒ‡å®šçš„æ˜¾è‘—æ€§æ°´å¹³ï¼Œæ¥å—åŸå‡è®¾ï¼Œè®¤ä¸ºæ ·æœ¬æ¥è‡ªæœä»æ­£æ€åˆ†å¸ƒçš„æ€»ä½“ï¼‰


```python
# ç”¨Shapiro-Wilkæ£€éªŒè¿›è¡Œæ­£æ€æ€§æ£€éªŒ
SW, pVal4 = stats.shapiro(res)
print(round(SW, 2))
print(round(pVal4, 2))

if pVal4 > alpha:
    print('\nAccept the null hypothesis.')
else:
    print('\nSince p-value > 0.05, reject the null null hypothesis') 
```

    0.96
    0.26
    
    Accept the null hypothesis.


ç”±ä¸Šè¿°åˆ†æå¯çŸ¥ï¼Œç»Ÿè®¡é‡ä¸º 0.96ï¼Œæ¥è¿‘ 1ï¼›ä¸”På€¼ä¸º 0.26ï¼Œå¤§äºæŒ‡å®šçš„æ˜¾è‘—æ€§æ°´å¹³ 0.05ã€‚æ•…è®¤ä¸ºæ®‹å·®æ¥è‡ªæœä»æ­£æ€åˆ†å¸ƒçš„æ€»ä½“ã€‚  

**Q3:**  
ç”±é¢˜æ„ï¼Œä½¿ç”¨ç‚¹ä¼°è®¡å¯¹å‚æ•°${\mu}_{i}$å’Œ$\sigma^2$è¿›è¡Œä¼°è®¡ã€‚ç”±è¯¾ä¸Šæ‰€å­¦å†…å®¹å¯çŸ¥ï¼Œä½¿ç”¨æœ€å¤§ä¼¼ç„¶ä¼°è®¡çš„æ–¹æ³•ï¼Œå¯ä»¥å¾—åˆ°å…¶ç‚¹ä¼°è®¡ä¸º$\hat{\mu}_{i}=\overline{y}_{iÂ·},\ \hat\sigma^2=MS_e$ã€‚åˆ©ç”¨pythonè®¡ç®—å¦‚ä¸‹ã€‚


```python
# Estimation of Parameter(ğœ2 and ğœ‡ğ‘– )
mu_1 = np.mean(group1)
mu_2 = np.mean(group2)
mu_3 = np.mean(group3)

mu = [mu_1, mu_2, mu_3]

sse = 0
for i in range(a):
    se = 0
    power_list = data[data[:,0] == (i + 1),1]
    for j in range(n):
        se += (power_list[j] - mu[i]) ** 2
    sse += se
var = round(sse / (a * (n - 1)),2) 
print('Estimate of the population meanï¼š{0}'.format(mu))
print('An estimate of the population varianceï¼š{0}'.format(var))
```

    Estimate of the population meanï¼š[116.05833333333334, 100.7, 100.18333333333332]
    An estimate of the population varianceï¼š10.43


ç”±ä¸Šè¿°åˆ†æå¯çŸ¥ï¼Œ3 ç§å·§å…‹åŠ›å¯¹åº”çš„è¡€æµ†çš„æ€»æŠ—æ°§èƒ½åŠ›å‡å€¼çš„ä¼°è®¡å€¼åˆ†åˆ«ä¸ºï¼š116.1, 100.7, 100.2  
å…¶æ–¹å·®çš„ä¼°è®¡å€¼ä¸ºï¼š10.43

**Q4:**  
ç”±Q1çš„åˆ†æå¯çŸ¥ï¼Œ3 ç§å·§å…‹åŠ›å¯¹åº”çš„è¡€æµ†çš„æ€»æŠ—æ°§èƒ½åŠ›å­˜åœ¨æ˜¾è‘—æ€§å·®å¼‚ï¼Œæ•…è¿›è¡Œå¤šé‡æ¯”è¾ƒã€‚è¿™é‡Œé‡‡ç”¨Fisheræœ€å°æ˜¾è‘—æ€§å·®å¼‚ï¼ˆLSDï¼‰æ–¹æ³•ã€‚  
æ£€éªŒï¼š$H_0: \mu_i = \mu_j$ vs $H_1: \mu_i \neq \mu_j$  
æ£€éªŒç»Ÿè®¡é‡ï¼š$t_0 = \frac{\overline{y}_{iÂ·} - \overline{y}_{jÂ·}}{\sqrt{MS_EÂ·2/n}}$  
å½“$|\overline{y}_{iÂ·} - \overline{y}_{jÂ·}| > t_{\frac{\alpha}{2},N-a}\sqrt{MS_EÂ·2/n}$æ—¶ï¼Œæ‹’ç»åŸå‡è®¾ï¼Œå¯è¡¨æ˜å‡å€¼å¯¹$\mu_i$ä¸$\mu_j$æœ‰æ˜¾è‘—æ€§å·®å¼‚ã€‚


```python
#LSD(least significant difference)æœ€å°æ˜¾è‘—å·®å¼‚
def LSD():   
    df = a * (n-1)
    t_value = stats.t(df).isf(alpha / 2)    
    mse = var
    lsd = t_value * math.sqrt(2.0 * mse / n)
    # print(lsd)
    return lsd

for i in range(a):
    for j in range(i + 1,a):
        dist = round(abs(mu[i] - mu[j]), 1)
        print('The difference between group', i + 1, 'and group', j + 1, ': ', dist)
print('Value of LSD: ', round(LSD(),2))
        
cmp = 0
for s in range(a):
    for t in range(s + 1, a):
        lsd = LSD()
        dist = round(abs(mu[s] - mu[t]), 1)
        if(dist < lsd):
            print('No difference between group', s + 1, 'and group', t + 1, ': ')
            cmp += 1
if(cmp == 0):
    print('Reject H0, and there is significant difference in the mean value of any two treatments')



```

    The difference between group 1 and group 2 :  15.4
    The difference between group 1 and group 3 :  15.9
    The difference between group 2 and group 3 :  0.5
    Value of LSD:  2.68
    No difference between group 2 and group 3 : 


ç”±äºLSDä¸´ç•Œå€¼å°äºgroup1å’Œ2ï¼Œgroup1å’Œ3çš„ä¸¤ç§å¤„ç†å‡å€¼çš„å·®ï¼Œæ•…æ‹’ç»åŸå‡è®¾ï¼Œè®¤ä¸ºgroup1å’Œ2ï¼Œgroup1å’Œ3çš„å‡å€¼å­˜åœ¨æ˜¾è‘—æ€§å·®å¼‚ã€‚
å¯¹äºgroup2å’Œ3ï¼ŒLSDä¸´ç•Œå€¼å¤§äºä¸¤ç§å¤„ç†å‡å€¼çš„å·®ï¼Œæ•…æ¥å—åŸå‡è®¾ï¼Œå³group2å’Œ3çš„å‡å€¼ä¸å­˜åœ¨æ˜¾è‘—æ€§å·®å¼‚ã€‚

## Week1 ä½œä¸š
ï¼ˆ1ï¼‰è€ƒè™‘å•å› å­æ–¹å·®åˆ†æ:$a=4, m=6, SS_T=10, SS_E=2.5$ã€‚å†™å‡ºæ–¹å·®åˆ†æè¡¨ã€‚ 

è§£ï¼š

$$
SS_A=SS_T-SS_E=10-2.5=7.5,\ n=a\times m=4\times 6=24,\ f_A=a-1=3, f_e=n-a=20,\\
f_T=n-1=23,\ MS_A=\frac{SS_A}{f_A}=7.5\div 3=2.5,\ MS_e=\frac{SS_E}{f_e}=2.5\div 20=0.125,\\
F=\frac{MS_A}{MS_e}=\frac{2.5}{0.125}=20,\ Y\sim F(f_A,f_e),\ p=P(Y\ge F)=3.102\times 10^{-6}
$$
ANOVA Table:

| æ¥æº | å¹³æ–¹å’Œ(SS) | è‡ªç”±åº¦(f) | å‡æ–¹(MS) | æ£€éªŒç»Ÿè®¡é‡(F) | på€¼  |
| ---- | ---------- | --------- | -------- | ------------- | ---- |
| å› å­ | 7.5        | 3         | 2.5      | 20            |3.102e-06      |
| è¯¯å·® | 2.5        | 20        | 0.125    |               |      |
| æ€»å’Œ | 10         | 23        |          |               |      |

ï¼ˆ2ï¼‰äºŒæ ·æœ¬æ—¶ï¼ŒAæ–¹æ³•$x_1,x_2,...,x_m$ï¼ŒBæ–¹æ³•$y_1,y_2,...,y_m$ã€‚è¯æ˜åœ¨å¹³è¡¡è®¾è®¡ï¼Œå› å­æ°´å¹³ä¸º$a=2$æ—¶ï¼ŒOne-way ANOVAç­‰ä»·äºäºŒæ ·æœ¬tæ£€éªŒã€‚

è§£ï¼š

ç”±é¢˜æ„ï¼Œè‹¥è¿›è¡Œå•å› å­æ–¹å·®åˆ†ææˆ–äºŒæ ·æœ¬tæ£€éªŒï¼Œå‡éœ€æœ‰ä»¥ä¸‹å‡è®¾ï¼š1.$x\sim N(\mu_x,\sigma_x^2),y\sim N(\mu_y,\sigma_y^2)$ï¼›2.$\sigma_x^2=\sigma_y^2=\sigma^2$ï¼›3.æ‰€æœ‰è¯•éªŒç»“æœå‡ç›¸äº’ç‹¬ç«‹ã€‚

ä¸¤ç§æ–¹æ³•å‡æ£€éªŒ$H_0:\mu_x-\mu_y=0\ vs\ H_0:\mu_x-\mu_y\ne0$ã€‚è®°$\overline x=\Sigma_{i=1}^m x_i,\overline y=\Sigma_{i=1}^m y_i$ã€‚
ä»¤æ€»å‡å€¼$\mu=\frac{\overline x+\overline y}2$ï¼Œ
æ€»åå·®å¹³æ–¹å’Œ$S_T=\Sigma_{i=1}^m(x_i-\mu)^2+\Sigma_{i=1}^m(y_i-\mu)^2$ï¼Œ
ç»„å†…åå·®å¹³æ–¹å’Œ$S_e=\Sigma_{i=1}^m(x_i-\overline x)^2+\Sigma_{i=1}^m(y_i-\overline y)^2$ï¼Œ
ç»„é—´åå·®å¹³æ–¹å’Œ$S_A=m[(\overline x-\mu)^2+(\overline y-\mu)^2]$ï¼Œ
åˆæ–¹å·®$s_w^2=\frac1{2m-2}[\Sigma_{i=1}^m(x_i-\overline x)^2+\Sigma_{i=1}^m(y_i-\overline y)^2]=\frac{S_e}{2m-2}$ã€‚

åˆ™å•å› å­æ–¹å·®åˆ†æçš„æ£€éªŒç»Ÿè®¡é‡$F=\frac{MS_A}{MS_e}=\frac{S_A/(2-1)}{S_e/2m-2}=\frac{2(m-1)S_A}{S_e}$ï¼ŒäºŒæ ·æœ¬tæ£€éªŒçš„æ£€éªŒç»Ÿè®¡é‡$t=\frac{\overline x-\overline y}{s_w\sqrt{\frac1m+\frac1m}}=\sqrt{\frac m2}\frac{\overline x-\overline y}{s_w}$ã€‚å…¶ä¸­$t\sim t(2m-2),\ F\sim F(1,2m-2)$ã€‚
$$
t^2={\frac m2}(\frac{\overline x-\overline y}{s_w})^2=\frac{m(\overline x-\overline y)^2}{2s_w^2}=\frac{m(\overline x-\overline y)^2}{2\frac{S_e}{2m-2}}=\frac{m(m-1)(\overline x-\overline y)^2}{S_e}\\=\frac{m(m-1)(\overline x-\mu-\overline y+\mu)^2}{S_e}=\frac{m(m-1)(\frac{S_A}m-2(\overline x-\mu)(\overline y-\mu))}{S_e}\\=\frac{(m-1)({S_A}-2m(\overline x-\mu)(\overline y-\mu))}{S_e}=\frac{(m-1)({S_A}-\frac12m(2\overline x-(\overline x+\overline y))(2\overline y-(\overline x+\overline y)))}{S_e}\\=\frac{(m-1)({S_A}+\frac12m(\overline x-\overline y)^2)}{S_e}=\frac{(m-1)({S_A}+S_A)}{S_e}=\frac{2(m-1)S_A}{S_e}=F
$$
æ‰€ä»¥ä¸¤ä¸ªæ£€éªŒç»Ÿè®¡é‡ä¹‹é—´çš„å…³ç³»æ»¡è¶³$t^2=F$ã€‚äºŒæ ·æœ¬tæ£€éªŒçš„æ‹’ç»åŸŸ$W=\{|t|\ge t_{1-\alpha/2}(2m-2)\}$ã€‚ç”±tåˆ†å¸ƒæ€§è´¨å¯çŸ¥ï¼Œè‹¥$t\sim t(2m-2)$ï¼Œåˆ™$t^2\sim F(1,2m-2)$ã€‚å› ä¸ºåŸå…ˆçš„æ‹’ç»åŸŸæ˜¯è®¡ç®—å¾—åˆ°çš„tè·ç¦»0è¾ƒå¤§çš„æƒ…å†µï¼Œå³tåˆ†å¸ƒçš„ä¸¤ä¸ªå°¾éƒ¨ï¼Œä¸¤ä¸ªå°¾éƒ¨çš„æ¦‚ç‡å’Œä¸º$\alpha$ã€‚åœ¨tå–å¹³æ–¹ä¹‹åï¼Œç¬¦åˆFåˆ†å¸ƒï¼ŒFåˆ†å¸ƒåªå–éè´Ÿå€¼ï¼Œä»…æœ‰ä¸€ä¸ªå°¾éƒ¨ï¼Œæ‰€ä»¥åº”ä½¿è½äºè¯¥å°¾éƒ¨çš„æ¦‚ç‡ä¸º$\alpha$ã€‚æ‰€ä»¥$W=\{t^2\ge F_{1-\alpha}(1,2m-2)\}=\{F\ge F_{1-\alpha}(1,2m-1)\}$ã€‚è¿™æ­£æ˜¯One-way ANOVAä¸­çš„æ‹’ç»åŸŸã€‚æ‰€ä»¥ä¸¤ä¸ªæ£€éªŒçš„æ‹’ç»åŸŸç›¸åŒã€‚

äºŒæ ·æœ¬tæ£€éªŒçš„på€¼ä¸º$p=P(|T|\ge|t|)$ï¼Œå…¶ä¸­$T\sim t(2m-2)$ï¼Œtä¸ºä¸Šè¿°æ£€éªŒç»Ÿè®¡é‡ã€‚åŒç†å¯å¾—$Y=T^2\sim F(1,2m-2),\ p=P(T^2\ge t^2)=P(Y\ge F)$ï¼Œå³One-way ANOVAä¸­çš„på€¼ã€‚æ‰€ä»¥ä¸¤ä¸ªæ£€éªŒçš„på€¼ç›¸åŒã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨é¢˜ç›®æ‰€è¿°æƒ…å†µä¸‹ï¼Œå•å› å­æ–¹å·®åˆ†ææˆ–å’ŒäºŒæ ·æœ¬tæ£€éªŒçš„åŸå‡è®¾åŠå¤‡æ‹©å‡è®¾ï¼Œæ‹’ç»åŸŸåŠpå€¼ç›¸åŒï¼Œæ£€éªŒç»Ÿè®¡é‡å…·æœ‰å¯¹åº”å…³ç³»ï¼Œå¯ä»¥ç›¸äº’è½¬åŒ–ã€‚æ‰€ä»¥é¢˜è¿°æƒ…å†µä¸‹ä¸¤ç§æ–¹æ³•ç­‰ä»·ã€‚

ï¼ˆ3ï¼‰è‡ªå­¦ã€Šæ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡ã€‹8.1.6èŠ‚ï¼Œæ•°æ®å¦‚å³ã€‚æ¨¡å‹ä¸ºï¼š$y_{ij}=\mu_i+\epsilon_{ij},\epsilon_{ij}\sim N(0,\sigma^2),i= 1,...,a;j=1,...,m_i$ã€‚
é—®é¢˜ï¼š1.å†™å‡ºæ•ˆåº”æ¨¡å‹ï¼›2.å†™å‡º$H_0,H_1$ï¼›3.å†™å‡ºANOVA TableåŠä¸­é—´ç¬¦å·çš„è®¡ç®—å…¬å¼ã€‚

è§£ï¼š

1.ä»¤æ€»å‡å€¼$\mu=\frac1n\Sigma_{i=1}^a m_i\mu_i$ï¼Œä»¤æ°´å¹³æ•ˆåº”$a_i=\mu_i-\mu$ã€‚æ•ˆåº”æ¨¡å‹ä¸º
$$
\left\{
\begin{aligned}
y_{ij}=\mu+a_i+\epsilon_{ij} \\
\Sigma_{i=1}^a m_ia_i=0 \\
è¯¸\epsilon_{ij}ç›¸äº’ç‹¬ç«‹ï¼Œä¸”éƒ½æœä»N(0,\sigma^2)
\end{aligned}
\right.
$$

2.$H_0:a_1=a_2=...=a_a=0\quad vs\quad H_1:a_1,a_2,...,a_aä¸å…¨ä¸º0.$

3.
$$
n=\Sigma_{i=1}^a m_i,\ \overline y_{iÂ·}=\frac1{m_i}\Sigma_{j=1}^{m_i}y_{ij},\ \overline y=\frac1n\Sigma_{i=1}^a\Sigma_{j=1}^{m_i}y_{ij},\\
S_A=\Sigma_{i=1}^a{m_i}(\overline y_{iÂ·}-\overline y)^2,\ S_e=\Sigma_{i=1}^a\Sigma_{j=1}^{m_i}(y_{ij}-\overline y_{iÂ·})^2,\ S_T=\Sigma_{i=1}^a\Sigma_{j=1}^{m_i}(y_{ij}-\overline y)^2
$$

ANOVA Table:

| æ¥æº  | å¹³æ–¹å’Œ(SS) | è‡ªç”±åº¦(f) | å‡æ–¹(MS)               | æ£€éªŒç»Ÿè®¡é‡(F)         | på€¼           |
| ----- | ---------- | --------- | ---------------------- | --------------------- | ------------- |
| å› å­A | $S_A$      | $f_A=a-1$ | $MS_A=\frac{S_A}{f_A}$ | $F=\frac{MS_A}{MS_e}$ | $p=P(Y\ge F)$ |
| è¯¯å·®e | $S_e$      | $f_e=n-a$ | $MS_e=\frac{S_e}{f_e}$ |                       |               |
| æ€»å’ŒT | $S_T$      | $f_T=n-1$ |                        |                       |               |


```python

```
